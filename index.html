<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>
		Canvas
	</title>
	<style type="text/css">
		body{
			width: 100%;
		}
		canvas{
			background-color: rgb(0, 0, 0);
			margin: auto; 
		} 
	</style>
</head>
<body>
	<canvas id="mycanvas" width="500" height="500">
		Tu navegador no soporta canvas
	</canvas>
	<script type="text/javascript">
		
		var cv = null;
		var ctx = null;
		var player1 = null;
		var meta = null;
		var pared = null;
		var direction = 'right';
		var speed = 10;
		var flameante = new Image();
		var cthulhu = new Image();
		var muro = new Image();
		var sonidogame = new Audio();
		var pause = false;
		function start()
		{
			cv = document.getElementById('mycanvas');
			ctx = cv.getContext('2d');
			player1 = new Cuadrado(20,20,40,40,'red');
			meta = new Cuadrado(generateRandomInteger(500),generateRandomInteger(500),40,40,'yellow');
			pared = new Cuadrado(40,80,30,300,'gray');
			flameante.src = 'PR.png';
			cthulhu.src = 'Final.png';
			muro.src = 'Muronormal.jpeg';
			sonidogame.src = 'musicgame.mp3';
			paint();
		} 
		function paint()
		{
			window.requestAnimationFrame(paint)
			ctx.fillStyle = "black";
			ctx.fillRect(0,0,500,500);
			ctx.fillStyle = "black";
			player1.c = "black";
			
			//player1.dibujar(ctx);
			ctx.drawImage(flameante,player1.x,player1.y,40,40);
			//meta.dibujar(ctx);
			ctx.drawImage(cthulhu,meta.x,meta.y, 60,60);
			//pared.dibujar(ctx);
			ctx.drawImage(muro,pared.x,pared.y,30,300);
			if (pause) {
				
				ctx.fillStyle = "rgba(0,0,0,0.5)";
				ctx.fillRect(0,0,500,500);
				ctx.fillStyle = "white";
				ctx.fillText('PAUSA',230,230);
			}else{
				update();
			}
			
		}
		function update()
		{
			
			if (direction == 'right') {
				player1.x += speed;
				if (player1.x>500) {
					player1.x = 0;
				}
			}
			if (direction == 'left') {
				player1.x -= speed;
				if (player1.x<0) {
					player1.x = 500;
				}
			}
			
			if (direction == 'down') {
				player1.y += speed;
				if (player1.y>500) {
					player1.y = 0;
				}
			}
			if (direction == 'up') {
				player1.y -= speed;
				if (player1.y<0) {
					player1.y = 500;
				}
			}
			if (player1.se_tocan(meta)) {
				meta.x = generateRandomInteger(500);
				meta.y = generateRandomInteger(500);
				speed += 5;
				sonidogame.play();
			}
			
			if (player1.se_tocan(pared)) {
				if (direction == 'right') {
					player1.x -= speed; 
				}
				if (direction == 'left') {
					player1.x += speed; 
				}
				
				if (direction == 'down') {
					player1.y -= speed; 
				}
				if (direction == 'up') {
					player1.y += speed; 
				}
			}
			
		}
		document.addEventListener('keydown',function(e){
			//arriba
			if (e.which == 87 || e.which == 38) {
				direction = 'up';
			}
			//abajo
			if (e.which == 83 || e.which == 40) {
				direction = 'down';
			}
			//izquierda
			if (e.which == 65 || e.which == 37) {
				direction = 'left';
			}
			//derecha
			if (e.which == 68 || e.which == 39) {
				direction = 'right';
			}
			//pause
			if (e.which == 32  ) { 
				pause = (pause)?false:true;
			}
		})
		window.addEventListener('load',start)
		window.requestAnimationFrame = (function () {
		    return window.requestAnimationFrame ||
		        window.webkitRequestAnimationFrame ||
		        window.mozRequestAnimationFrame ||
		        function (callback) {
		            window.setTimeout(callback, 17);
		        };
		}());
		function Cuadrado(x,y,w,h,c)
		{
			this.x = x;
			this.y = y;
			this.w = w;
			this.h = h;
			this.c = c;
			this.se_tocan = function (target) { 
				if(this.x < target.x + target.w &&
				   this.x + this.w > target.x && 
				   this.y < target.y + target.h && 
				   this.y + this.h > target.y)
				{
					return true;  
				}  
			};
			this.dibujar = function(ctx){
				ctx.fillStyle = this.c;
				ctx.fillRect(this.x,this.y,this.w,this.h);
				ctx.strokeRect(this.x,this.y,this.w,this.h);
			}
		}
		function random_rgba() {
		    var o = Math.round, r = Math.random, s = 255;
		    return 'rgba(' + o(r()*s) + ',' + o(r()*s) + ',' + o(r()*s) + ',' + r().toFixed(1) + ')';
		}
		function generateRandomInteger(max) {
		    return Math.floor(Math.random() * max) + 1;
		}
	</script>
</body>
</html>
